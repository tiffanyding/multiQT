import pandas as pd
import numpy as np
import pdb

# To access and read files in S3 bucket
import h5py
import s3fs

ISO_to_sites = {'ERCOT': {'Wind': ['Aguayo_Wind', 'Ajax_Wind', 'Amazon_Wind_Farm_Texas', 'Anacacho_Wind_Farm', 'Appaloosa_Run_Renewable_Energy_Project', 'Aquilla_Lake_2_Wind', 'Aquilla_Lake', 'Armstrong_Wind', 'Azure_Sky_Wind_1', 'Azure_Sky_Wind_2', 'Baffin', 'Baird_North_Wind', 'Barranca_Wind_Ii', 'Barranca_Wind', 'Barrow_Ranch', 'Barton_Chapel_Wind_Farm', 'Bearkat_I', 'Bethel', 'Big_Sampson_Wind', 'Big_Spring_Wind_Farm', 'Black_Jack_Creek_Wind', 'Blanco_Canyon_Wind', 'Blue_Summit_Ii', 'Blue_Summit_Repower', 'Blue_Summit_Wind_Iii', 'Blue_Summit', 'Bobcat_Bluff_Repower', 'Bobcat_Bluff', 'Brazos_Wind_Ranch', 'Briscoe', 'Broadview_Energy_Jn_Llc', 'Bruennings_Breeze', 'Buckthorn', 'Buenos_Aires_1_Wind', 'Buenos_Aires_2_W', 'Buffalo_Gap_4', 'Buffalo_Gap_Wind_Farm', 'Bull_Creek_Wind_Farm', 'Cabezon_Wind', 'Cactus_Flats_Wind', 'Callahan_Divide_Wind_Energy_Center', 'Cameron', 'Camp_Springs_Ii_Wind_Farm', 'Canadian_Breaks_Wind', 'Canyon_Wind', 'Capricorn_I_Iii_Repower', 'Capricorn_Iv_Repower', 'Capricorn_Ridge', 'Cattleman_Wind_A', 'Cattleman_Wind_B', 'Cedro_Hill', 'Century_Oak_Wind', 'Chalupa_Wind', 'Champion_Roscoe_Ii_Wind_Farm', 'Changing_Winds', 'Chapman_Ranch', 'Chocolate_Bayou_W', 'Cirrus_1', 'Cotton_Plains_Wind', 'Coyote_Wind', 'Cranel_Wind', 'Darmstadt', 'Delaware_Mountain_Wind_Farm', 'Desert_Sky_Repower', 'Desert_Sky_Wind_Farm', 'Dillon_Gulch', 'East_Raymond_Wind', 'Easter_Wind', 'Edmondson_Ranch_Wind', 'El_Algodon_Alto_W', 'El_Suaz_Ranch', 'Elbow_Creek_Wind_Farm', 'Electra_Wind', 'Erawind', 'Espiritu_Wind', 'Exelon_Wind_11', 'Falvez_Astra', 'Flat_Top', 'Fluvanna_I', 'Foard_City_Wind', 'Forest_Creek_Wind_Farm', 'Foxtrot_Wind', 'Frisco', 'Goat_Mountain_Phase_Wind_Farm', 'Golden_Spread_Panhandle_Wind_Ranch', 'Goldthwaite', 'Goodnight_Wind', 'Gopher_Creek_Wind', 'Grandview_4_Phase_A_Wind', 'Grandview_5_W', 'Grandview', 'Grape_Creek_Wind', 'Great_Plains_Wind_Farm', 'Green_Pastures', 'Griffin_Trail_Wind', 'Gulf_Wind_2_Expansion', 'Gulf_Wind_2', 'Gulf_Wind_Farm', 'Gunsight', 'Gusty_Hill_Wind', 'Hackberry_Wind_Project', 'Hale_1', 'Harald_Bearkat_Wind_B', 'Hart_Wind', 'Hereford_1', 'Hidalgo_Ii_Wind', 'Hidalgo', 'High_Lonesome_W', 'High_Lonesome_Wind_Phase_Ii', 'Horse13_Calld_Repower', 'Horse_Creek_Wind', 'Horse_Hollow', 'Impala_Flats_Wind', 'Inadale_Roscoe_Iv_Wind_Farm', 'Indian_Mesa_Wind_Farm_I', 'Javelina', 'Jd_Wind_Farm', 'Jumbo_Road', 'Kaiser_Creek_Wind', 'Karankawa_2_Expansion', 'Karankawa_2_Wind', 'Karankawa_Wind', 'Keechi', 'King_Mountain', 'Kontiki_1_Wind_Erik', 'Kontiki_2_Wind_Ernest', 'La_Casa_Wind', 'La_Joya_I_Wind', 'La_Joya_Ii_Wind', 'Lacy_Creek_Wind_Phase_1', 'Langford_Wind_Farm', 'Las_Lomas_Wind', 'Las_Majadas_Wind', 'Little_Pringle', 'Llano_Estacado_Wind_Ranch_At_White_Deer', 'Lockett_Wind', 'Logans_Gap_Wind', 'Loma_Pinta_Ii', 'Loma_Pinta_Wind', 'Lone_Star_I_Wind_Farm', 'Longhorn', 'Loraine_Windpark_Phase_Iii', 'Loraine', 'Los_Vientos', 'Lubbock_Wind_Ranch', 'Lutum', 'Magic_Valley', 'Magnet_Wind', 'Majestic', 'Mariah_Del_Este', 'Mariah_North_Wind', 'Maryneal_Windpower', 'Maverick_Creek_I', 'Maverick_Creek_Ii', 'Mcadoo_Wind_Farm', 'Mesquite_Creek', 'Mesteno_Windpower', 'Miami_Texas_Wind', 'Midway_Wind', 'Monte_Alto_2_Wind', 'Monte_Alto_I', 'Monte_Bueno', 'Monte_Cristo_1_W', 'Monte_Cristo_2_Wind', 'Montgomery_Ranch_Wind', 'Mozart', 'Northdraw_Wind', 'Notrees', 'Ocotillo', 'Octotillo_Wind_Farm', 'Old_Settler_Wind', 'Oveja_Wind', 'Palmas_Altas_Wind', 'Palo_Duro', 'Panhandle_Wind_3', 'Panhandle_Wind', 'Pantex_Plant_Wind_Project', 'Panther_Creek_I_Wind_Farm', 'Panther_Creek_Ii_Wind_Farm', 'Panther_Creek_Iii_Wind_Farm', 'Panther_Creek', 'Papalote_Creek', 'Pease_River_Wind', 'Penascal_Ii', 'Penescal_Wind_Farm', 'Peyton_Creek_Wind_Ii', 'Peyton_Creek_Wind', 'Pierce_Wind', 'Pleasant_Hill', 'Prairie_Hill_Wind', 'Priddy_Wind', 'Pumpkin_Farm_Wind', 'Pyco_Soaring_Wind_Farm', 'Pyron_Roscoe_Iii_Wind_Farm', 'Ralls_Wind_Farm', 'Ranchero_Wind', 'Rattlesnake', 'Red_Canyon_Wind_Farm', 'Red_Mud_Creek', 'Reloj_Del_Sol_Wind', 'Roadrunner_Crossing_Wind_1', 'Rocksprings', 'Roscoe_Wind_Farm', 'Route_66', 'Rts_2_Wind', 'S_Hills_Wind', 'Sage_Draw_Wind', 'Salt_Fork', 'San_Roman', 'Sand_Bluff_Repower', 'Sand_Bluff_Wind_Farm', 'Senate', 'Sendero', 'Shaffer', 'Shamrock_Wind_Ii', 'Shamrock_Wind', 'Shanghai_Wind', 'Shannon', 'Sherbino', 'Silver_Star_Wind_Farm', 'Snyder_Wind_Project', 'South_Trent_Mesa_Wind_Farm', 'Southwest_Mesa_Wind_Farm', 'Spinning_Spur', 'Stanton_Energy_Center_Wind_Farm', 'Stella_2_Wind', 'Stephens_Ranch', 'Sunray_Wind_Farm', 'Sweetwater_1_Repower', 'Sweetwater_2_Repower', 'Sweetwater', 'Tecovas_1_W', 'Tecovas_2_W', 'Tehuacana_Wind', 'Tg_East_Wind', 'Tierra_Blanca_W', 'Tiger_Wind', 'Torrecillas_Wind', 'Trent_Mesa_Wind_Farm', 'Trent_Repower', 'Trinity_Hills', 'Turkey_Track_Wind_Farm', 'Tyler_Bluff', 'Vaquero_1_Wind', 'Vaquero_2_Wind', 'Vera_Wind', 'Wake', 'Water_Valley_Wind_Energy', 'Wege_Wind_Farm', 'West_Raymond_Wind', 'West_Texas_Windplant', 'Whirlwind_Wind_Farm', 'White_Mesa_Wind', 'White_Tail', 'Whitehorse_Wind', 'Wildorado_Wind_Farm', 'Wildrose_Wind', 'Willow_Springs_Wind_Farm', 'Wilson_Ranch', 'Wind_Power_Partners_94_Wind_Farm', 'Windthorst_2', 'Wkn_Amadeus_Wind', 'Wolf_Ridge_Wind_Farm', 'Woodward_Mountain_I_Ii_Wind_Farm'],
                          'Solar': ['Adamstown_Solar', 'Agate_Solar', 'Angelina_Solar', 'Angelo_Solar', 'Angus_Solar', 'Anson_Solar_Center,_Phase_III', 'Anson_Solar_Center,_Phase_II', 'Anson_Solar', 'Aragorn_Solar', 'Arroyo_Del_Bisonte_Solar', 'Arroyo_Solar', 'Atascosa_I_Solar', 'Bacon_Switch_Solar', 'Basalt_Solar', 'Bestla_Solar', 'Blackwater_Draw_Solar', 'BlueBell_Solar', 'Blue_Bell_Solar_II', 'Blue_Jay_Solar_', 'Bluebonnet_Solar', 'Bravepost_Solar', 'Brightside_Solar', 'Brushy_Creek_Solar', 'Castro_Solar', 'Charbray_Solar', 'Chatee_Solar', 'Citrine_Solar', 'Concho_Valley_Solar', 'Coniglio_Solar', 'Corazon_Solar', 'Cottonwood_Bayou', 'County_Line_Solar', 'Crowded_Star_Solar', 'Cutlass_Solar', 'Danciger_Solar', 'Danish_Fields_III', 'Danish_Fields_II', 'Danish_Fields_Solar', 'Dawn_Solar', 'Delilah_Solar_1', 'Delilah_Solar_2', 'Delilah_Solar_3', 'Desert_Rose', 'Dexter_Solar', 'Diamondback_Solar', 'Double_R_Solar', 'Dove_Run', 'EK_Tipton_Solar', 'El_Zorro_Solar', 'Elara_Solar', 'Elrond', 'Emerald_Grove_Solar', 'Eunice_Solar', 'Fighting_Jays_Solar', 'Flag_City', 'Flatland_Solar', 'Fluorite_Solar', 'Fort_Bend_Solar', 'Fowler_Ranch', 'French_Goldston_Solar', 'Fronton_Solar', 'Frye_Solar', 'GSE_Eleven', 'Galloway_Solar', 'Garnet_Solar', 'Gold_Creek_Solar', 'Goodranch_Solar', 'Greasewood_II', 'Greasewood_Solar', 'Green_Holly_Solar', 'Greyhound_Solar_2', 'Greyhound_Solar', 'HOVEY', 'Half_Moon_Solar', 'Hallmark_Solar', 'Hecate_Solar', 'Hill_Solar', 'Holstein_2_Solar', 'Holstein_Solar', 'Hopkins', 'Horizon_Solar', 'Horseshoe_Bend_Solar', 'Howle_Solar', 'IP_Titan', 'Impact_Solar', 'Indigo_Solar', 'Inverter_Field_Solar', 'Juno_Solar', 'Kellam_Solar', 'King_Mountain_Solar', 'Knickerbocker_Road_Solar', 'Kochab_Solar', 'Lapetus_Solar_2', 'Lily_Solar', 'Long_Draw_Solar', 'Long_Point_Solar', 'Longbow_Solar', 'Lueders_Solar', 'Lumina', 'Lunis_Creek_Solar_1', 'Lunis_Creek_Solar_2', 'M-Bar_Solar', 'Maleza_Solar', 'March_Road_Solar', 'Markum_Solar', 'Mercury_Solar', 'Millhouse_Solar', 'Misae_Solar_II', 'Misae_Solar', 'Morada_Del_Sol_Solar', 'Morrow_Lake_Solar_II', 'Morrow_Lake_Solar', 'Murphy_Lake_Solar', 'Mustang_Creek_Solar', 'Myrtle_Solar', 'Nazareth_Solar', 'Neeley_Solar', 'Noble_Solar', 'Normande_Solar_Farm', 'Norton_Solar', 'Oberon_Solar', 'Obsidian_Solar', 'Opal_Solar', 'Owego_Solar', 'Owens_Solar', 'Oxbow_Solar', 'Oxy_Solar', 'Pflugerville_2_Solar', 'Pflugerville_Solar', 'Phoebe_Solar', 'Phoenix_Solar', 'Pine_Forest_Solar', 'Pitts_Dudik_Solar', 'Ponwar_Solar_Farm', 'Prickly_Pear', 'Prospero_Solar_II', 'Prospero_Solar', 'Quantum_Increase', 'Quantum', 'Queen_Solar', 'RE_Maplewood_2a_Solar', 'RE_Maplewood_2b_Solar_', 'RE_Maplewood_2c_Solar_', 'Radian_Increase', 'Radian', 'Rambler_Solar', 'Ramsey_Solar', 'Rayos_Del_Sol', 'Red_Holly_Solar', 'Reiher_Solar', 'Rippey_Solar', 'Robles_Solar', 'Rodeo_Solar', 'Roseland', 'SP-Pecos_Bend_Solar_A', 'SP-Pecos_Bend_Solar_B_', 'SP_TX-12B_Phase_III', 'SP_TX-12B_Phase_II', 'Samson_Solar_2', 'Samson_Solar_3', 'Samson_Solar', 'San_Bernard_Solar', 'Sandine_Solar', 'Santa_Rita_Solar', 'Shakes_Solar', 'Shorthorn_2_Solar', 'Signal_Ranch', 'Sisters_Solar', 'Smithland_Texas_Solar', 'Soda_Lake_Solar_1', 'Soda_Lake_Solar_2', 'Solemio', 'Space_City_Solar', 'Spanish_Crown', 'Spectrum', 'Spinel_Solar', 'Starr_Solar_Ranch', 'Stillwater_Solar', 'Strategic_Energy', 'Sun_Valley_2', 'Sun_Valley', 'Sunshine_Solar', 'Taygete_II_Solar', 'Taygete_Solar', 'Texana_Solar', 'Texas_Solar_Nova', 'Thickgrass_Solar', 'Timberwolf_POI_A', 'Tom_Green_Solar', 'Trevino_Solar', 'Tri-County_Solar', 'Tulsita_Solar', 'Tyson_Nick_Solar', 'Ulysses_Solar', 'Upton_Solar', 'Vancourt', 'Vision_Solar', 'Wagyu_Solar', 'Wake_Solar', 'Wang_Solar', 'West_of_Pecos_Solar', 'Westoria_Solar', 'Whatley_Solar', 'Zier_Solar', 'solar109', 'solar21', 'solar22', 'solar286', 'solar287', 'solar288', 'solar289', 'solar290', 'solar291', 'solar362', 'solar363', 'solar364', 'solar365', 'solar3', 'solar433', 'solar434', 'solar435', 'solar436', 'solar437', 'solar438', 'solar509', 'solar530']},
                'NYISO': {'Wind': ['Alle_Catt_II_Wind', 'Arkwright_Summit', 'Atlantic_Shores_Offshore_Wind_7', 'Atlantic_Shores_Offshore_Wind_8', 'Atlantic_Shores_Offshore_Wind_9', 'Ball_Hill_Wind', 'Blue_Hill_Wind', 'Bluestone_Wind', 'Bone_Run_Wind', 'Bull_Run_II_Wind', 'Bull_Run_Wind', 'CWW_200_Wind', 'CWW_300_MW_DUN', 'CWW_300_Wind', 'Copenhagen', 'Deer_River_Wind', 'Dutch_Hill', 'EI_East_Shoreham', 'EI_Fort_Salonga', 'EI_Glenwood_Landing', 'EI_Melville', 'EI_Oceanside_2', 'EI_Oceanside', 'EI_Steinway_1', 'EI_Steinway_2', 'EI_Sunset_Park', 'East_Wind_1', 'Eight_Point_Wind_Energy_Center', 'Fenner_Wind_Power_Project_-_Repower', 'Fenner_Wind_Power_Project', 'Harbec_Plastics', 'Hardscrabble', 'Heritage_Wind', 'High_Bridge_Wind', 'High_Sheldon', 'Howard', 'Jericho_Rise', 'Long_Island_Offshore_Wind_Connection', 'Long_Island_Offshore_Wind', 'Mad_River_Wind', 'Madison_Windpower', 'Maple_Ridge_(Lowville)', 'Maple_Ridge', 'Marble_River', 'Marsh_Hill', 'Munnsville', 'NY_Wind_-_East_Garden_City', 'NY_Wind_-_Mott_Haven', 'NY_Wind_-_Pilgrim', 'NY_Wind_Gowanus', 'NY_Wind_Holbrook_2', 'NY_Wind_Holbrook', 'New_York_City_Offshore_Wind', 'Noble_Altona', 'Noble_Bliss', 'Noble_Chateaugay', 'Noble_Clinton', 'Noble_Ellenburg', 'Noble_Wethersfield', 'North_Country_Wind', 'North_Slope_Wind', 'Orangeville_Wind', 'Prattsburgh_Wind_Farm', 'Rolling_Upland_Wind', 'South_Fork_Wind_Farm_II', 'South_Fork_Wind_Farm', 'Steel_Winds_II', 'Steel_Winds', 'Stockbridge_Wind', 'Vineyard_Wind_II', 'Vineyard_Wind_I', 'Wethersfield', 'Zotos'],
                          'Solar': ['100_Brook_Hill_Drive_Solar', '25_Ashdown_Road_Solar_LLC', '311_Douglas_Road', 'Addison_Solar_Project', 'Aegis_CSG', 'Alabama_Solar_Park_LLC', 'Albany_County_1', 'Albany_County_2', 'Allegany_2_Solar', 'Amsterdam_North', 'Amsterdam_South', 'Anheuser_Busch_Baldwinsville', 'Baer_Road_CSG', 'Bakerstand_Solar', 'Barneveld_Solar', 'Bear_Ridge_Solar', 'Beardslee_Solar', 'Bennett', 'Bethlehem_East', 'Bethlehem_Solar', 'Bethlehem_West', 'Blydenburgh_Solar_Project', 'Boas_Rd_1_Community_Solar_Farm', 'Boas_Rd_2_Community_Solar_Farm', 'Boas_Rd_3_Community_Solar_Farm', 'Breesport_Road_Community_Solar_Farm', 'Brentwood_Solar', 'Broadalbin_Perth_Solar', 'Broadalbin', 'Brookside_Solar', 'Broome_County', 'CBP_Solar', 'CDG_Owego_2_LLC', 'CJ_Solar_I_LLC', 'CMR_Solar_LLC', 'COU_Solar_I_LLC', 'Calabro_Airport_North_Solar_Project', 'Calabro_Airport_South_Solar_Project', 'Call_Farms_1', 'Call_Farms_3', 'Calverton', 'Camden_CSD_Solar_Array', 'Canandaigua_Solar_Array', 'Canandaigua_Westbrook_Solar_Array', 'Catlin_Solar_1_LLC', 'Cayuga_Solar', 'Cedar_Creek_PV', 'Chenango_Solar', 'Chester_CSG', 'Cider_Solar', 'City_of_Rochester_Solar', 'Clarkson_Solar', 'Clarkstown_Landfill_Solar_Facility', 'Clay_Solar', 'Clear_View_Solar', 'Cobleskill_Solar_Project', 'Cohalan', 'Columbia_County_1', 'Columbia_Solar_Energy_Center', 'Columbia_University_Johnson_Farms', 'Columbia_University_Minisink', 'Cornell_Geneva_Solar_Farm', 'Cornell_Snyder_Road_Solar_Array', 'Cortland_Energy_Center', 'Coverdale_Solar', 'Cummins_Inc', 'Czub_CSG', 'Declaration_Energy_Center', 'Deer_Park', 'Delight_Farm', 'Dennison', 'Dog_Corners_Solar', 'Dolan_Solar', 'Dover_CSG', 'Dryden_Rd_2_Community_Solar_Farm_CSG', 'Duanesburg', 'ELP_Rotterdam_Solar', 'East_Light_Energy_Center', 'East_Point_Solar', 'Ellis_Solar', 'Ellsworth_I_CSG', 'Empire_Solar', 'Enfield_Community_Solar', 'Erie_Wyoming_County_Solar', 'Excelsior_Energy_Center', 'Fairway_Solar', 'Farwell_Solar', 'Finger_Lakes_Solar_I', 'Flat_Creek_Solar_2', 'Flat_Creek_Solar', 'Flat_Hill_Solar', 'Flint_Mine_Solar', 'Forrence_Orchards', 'Fort_Edward_Solar_Farm_NY53', 'Franklin_Solar_', 'Frog_Hollow_CSG', 'Garnet_Energy_Center', 'Garnet_Solar_NY', 'Gaskill_Rd_Community_Solar_Farm_CSG', 'Gedney_Hill_Solar', 'Genesee_Road_Solar_Energy_Center', 'Gifford_CSG', 'Gore_Mountain_Solar_II', 'Grand_Prix_Solar', 'Grassy_Knoll_Solar', 'Greene_County_Energy', 'Greenville_CSG', 'Grissom_Solar', 'Guildlerland_CSG', 'HGS_Solar_I', 'Half_Moon_Solar', 'Hampton_Corners_Solar', 'Harford_Solar_Farm', 'Hatchery_Solar', 'High_River_Solar', 'Highview_Solar', 'Hills_Solar', 'Hilltop_Solar', 'Hobart_William_Smith_College_Gates_Rd', 'Holley_Road_Solar', 'Hollygrove_CSG', 'Holtsville_Solar_Project', 'Homer_Solar_Energy_Center', 'Homer_Street_East', 'Homer_Street_West', 'Hope_Solar_Farm_LLC', 'Horseshoe_Solar', 'Hospital_Rd_Community_Solar_Farm_CSG', 'Houghton', 'Howland_CSG', 'IRE_Solar_I_LLC', 'Janis_Solar', 'Jaton', 'Jefferson_Lewis_BOCES_Solar', 'Johnstown_Solar_1_LLC', 'Johnstown_Solar', 'Johnstown', 'K_High', 'Katrina_Falls', 'Kearsarge_Johnstown_1_CSG', 'Kearsarge_Johnstown_2_CSG', 'Kearsarge_Oppenheim_CSG', 'Kinder_Morgan_Fordham', 'Kingbird_Solar', 'Kings_Park_Solar_II', 'Kings_Park_Solar_I', 'Knaggs_Brothers_Farm', 'Knickerbocker_Solar', 'Lacona_Solar', 'Leavenworth_Greenworks_LLC', 'Letchworth_Solar_Project', 'Lichtenthal', 'Limestone_Solar', 'Lincoln_Ave_Solar_Project', 'Little_Pond_Solar', 'Long_Island_Solar_Farm_LLC', 'Macedon', 'Madison_County', 'Madison_Solar', 'Magruder_Solar', 'Malone_Solar_', 'Manchester_Solar', 'Marshville_Solar', 'Martin_Rd_Solar', 'Mattas_Farms', 'Mereand_CSG', 'Mill_Point_Solar', 'Millbrook_School', 'Millers_Grove_Solar', 'Milliken_Solar_Project', 'Mineral_Basin_Solar_Power', 'Minisink_Community_Solar_2_LLC', 'Minisink_Solar_1_LLC', 'Mohawk_Solar', 'Mohonasen_Central_School_District', 'Monroe_County_Sites_A_B', 'Monroe_County_Sites_C_D_E', 'Moraine_Solar_Energy_Center', 'Morris_Ridge_Solar_Energy_Center', 'Morris_Solar_Project', 'Morrow_Farms_LLC', 'Musgrave_East_Solar_Farm', 'Musgrave_West_Solar_Farm', 'NY08_Solar', 'NY109_Solar', 'NY13_Solar', 'NY16_Solar', 'NY37_Solar', 'NY38_Solar', 'New_Bremen_Solar', 'Newfield_Community_Solar_LLC', 'Niagara_Dolomite_Solar', 'North_County', 'North_Light_Energy_Center', 'North_Side_Solar', 'Oneida_South', 'Oneida_West', 'Onondaga_County_Jamesville', 'Onondaga_County_Metro_Water_Board', 'Onondaga_County_Oak_Orchard_WWTP', 'Onyx_Lamphear_Road_CSG', 'Onyx_Saratoga_Springs_Landfill_Solar_CSG', 'Orleans_Solar', 'Oswego_County_Fulton_Solar', 'Owens_Corning_at_Bethlehem', 'Oxbow_Hill_Solar', 'Pasto_Solar', 'Pearl_CSG', 'Pearl_II', 'Podunk_Road_CSG', 'Pool_Brook_Rd_Community_Solar_Farm', 'Port_Richmond_WWT_Solar', 'Puckett_Solar', 'RIT_Henrietta_Solar_1_LLC', 'RT_52_Walden_Solar_1_LLC', 'Ransomville_Solar_1_LLC', 'Ray_Solar_LLC', 'Regan_Solar', 'Rich_Road_Solar_Energy_Center', 'Richardson_Solar', 'Ridge_View_Solar_Energy_Center', 'Riley_Road_LLC', 'Rising_Solar_II', 'Riverhead_Expansion', 'Riverhead_Solar_Farm', 'Riverhead', 'Riverline_Energy_Center', 'Riverside_Solar', 'Rosalen_Solar_Energy_Center', 'Route_14A_CDG_Solar_North_and_South_LLC', 'Route_318', 'Rutland_Center_Solar', 'SL_Babylon', 'SL_Portland_Solar', 'Sacket_Lake_Rd_2_Community_Solar_Farm', 'Saratoga_Solar_LLC', 'Sharon_Springs_Interconnection', 'Sharon_Springs', 'Shoreham_Solar_Commons', 'Silver_Lake_Solar', 'Silverline_Energy_Center', 'Skidmore_College', 'Sky_High_Solar', 'Skyline_Solar', 'Solean_Solar_Project', 'Somers_Solar_LLC', 'Somerset_Solar', 'South_Ripley_Solar', 'St_Lawerence_University_Sutton', 'Steel_Sun_2_2303_III_2_Hamburg_Tpke', 'Steel_Sun_2_2303_III_4_Hamburg_Tpke', 'Steel_Sun_2_2303_III_9_Hamburg_Tpke', 'Steel_Sun', 'Sterlington_Greenworks_LLC', 'Stone_Mill_Solar', 'Strauss_CSG', 'Suffragette_Solar_Energy_Center', 'Sugar_Maple_Solar', 'Sugarhill_Road_Solitude_Solar_CSG', 'Sullivan_County_Adult_Care_Solar', 'SunEast_Flat_Stone_Solar_LLC', 'SunEast_Manchester_Solar_LLC', 'SunEast_Oriskany_Solar_LLC', 'Sunlight_Beacon', 'Sunset_Hill_Solar', 'Sutter_Greenworks_LLC', 'Tabletop_Solar', 'Tannery_Road_Landfill', 'Tayandenega_Solar', 'Teele', 'Thousand_Island_Solar', 'Ticonderoga_Solar', 'Time_Warner_Cable_Enterprises_Martino', 'Time_Warner_Cable_Knowles', 'Tompkins_Cortland_Community_College', 'Town_of_Williamson_Landfill_PV', 'Tracy_Solar_Energy_Centre', 'Transit_Solar_Project', 'Troupsburg_Solar', 'Tubolino_2', 'Turner_Rd_Community_Solar_Project', 'Ulster_County_Solar', 'Valley_Solar', 'Verona_Solar_Energy_Center_II', 'Verona_Solar_Energy_Center_I', 'Villa_Roma_Rd_3_CSG', 'Villa_Roma_Rd_4_CSG', 'Vulcraft_Solar', 'Warner_Hill_Solar_Project', 'Watkins_Glen_Solar', 'Watkins_Rd_Solar', 'Westmorland_Solar', 'White_Creek_Solar', 'White_Spring_Solar', 'Whittier', 'Williamson', 'Woodoak_Drive_Community_Solar_Farm_CSG', 'Yellow_Barn_Solar']},
                'MISO': {'Wind': ['Adair', 'Adams_Wind_Generations,_LLC', 'Adams', 'Agassiz_Beach', 'Agriwind', 'Apple_Blossom', 'Arbor_Hill', 'Ashtabula_III', 'Ashtabula_II', 'Ashtabula_Wind_Center', 'August_Wind_Energy_LLC', 'Baldwin', 'Barton', 'Beaver_Creek', 'Beebe_1B', 'Beebe_Community_Wind', 'Bent_Tree', 'Big_Blue_Wind_Farm', 'Big_Turtle_II', 'Big_Turtle', 'Bingham_Lake', 'Birch_Power_LLC', 'Bishop_Hill_III', 'Bishop_Hill_II', 'Bishop_Hill_I', 'Bison_1B_(2011)', 'Bison_Wind_1A', 'Bison_Wind_1B', 'Bison_Wind_2', 'Bison_Wind_3', 'Bison_Wind_4', 'Black_Oak_Getty', 'Blue_Breezes_I_&_II', 'Blue_Sky_-_Green_Field', 'Border_Winds_Project', 'Brookfield_Wind_Park', 'Brown_County_Wind_Turbine', 'Buffalo_Ridge_II', 'Buffalo_Ridge', 'Bulldog', 'Butler_Ridge', 'California_Ridge', 'Cannon_1', 'Cannon_II', 'Carleton_College', 'Carroll_Area', 'Carroll', 'Cashton_Greens', 'Cedar_Hills', 'Cedar_Ridge_Wind_Farm', 'Century_Expansion', 'Century', 'Cerro_Gordo_Hawkeye_Power_Clear_Lake', 'Champepaden,_Chandler_Hills_Phase_II', 'Chanarambie', 'Charles_City', 'Community_Wind_North', 'Community_Wind_South', 'Courtenay', 'Crane_Creek', 'Crocker', 'Cross_Winds_Energy_Park_III', 'Cross_Winds_Energy_Park_II', 'Cross_Winds_Energy_Park', 'Cross_Winds', 'Crowned_Ridge_I', 'Crystal_Lake_III', 'Crystal_Lake_II', 'Crystal_Lake_I', 'Cumberland_Rose', 'Danielson', 'Deerfield', 'Diamond_Willow_Wind', 'Diamond_Willow_extension', 'East_Ridge', 'Echo', 'Eclipse', 'Elk', 'Elm_Creek_II', 'Elm_Creek', 'Emmons-Logan', 'Endeavor_II', 'Endeavor', 'English_Farms', 'Eolos', 'Ewington', 'Fairmont_Wind_(SMMPA)', "Farmer's", "Farmers'_coops_Westridge", 'Farmers_City', 'Fenton', 'Flying_Cloud', 'Forward_Fontanelle', 'Forward_Wind_Project', 'Franklin_County', 'G._McNeilus_Wind_Farm', 'GL_Wind', 'Galactic_Wind', 'Geneseo_Wind_Farm', 'Glacier_Hills', 'Glaciers_Edge', 'Glen_Ullin_Energy_Center_(Clean_Energy_1)', 'Goodland_I', 'Grand_Meadow', 'Grant_County', 'Gratiot_County', 'Gratiot', 'Green_Energy_Machine', 'Green_Mountain_Power', 'Greenfield_Wind', 'Hancock_County_Wind_Farm', 'Hardin-Hilltop', 'Harvest_II', 'Harvest_Wind_Farm', 'Hawkeye', 'Heartland_Community_College', 'Heartland_Divide', 'Heritage_Garden', 'Highland_II', 'Highland_I', 'Hilltop_Power', 'Hoopeston_Wind', 'Hoosier', 'IDGWP', 'Ida_Grove_II', 'Ida_Grove', 'Illinois_Rural_Electric_Cooperative', 'Intrepid_Expansion', 'Intrepid', 'Iowa_Lakes_Community_College', 'Ivester', 'J1022', 'J1024', 'J1040', 'J1043', 'J1050', 'J1069', 'J1106', 'J1115', 'J1122', 'J1175', 'J1181', 'J1187', 'J1194', 'J1244', 'J1270', 'J1289', 'J1292', 'J1315', 'J1319', 'J1338', 'J1341', 'J1360', 'J1365', 'J1371', 'J1374', 'J1376', 'J1427', 'J1432', 'J1437', 'J1453', 'J1454', 'J1456', 'J1467', 'J1483', 'J1485', 'J1487', 'J1508', 'J1512', 'J1521', 'J1557', 'J1575', 'J1594', 'J1613', 'J1621', 'J1666', 'J1667', 'J1675', 'J1676', 'J1701', 'J1713', 'J1725', 'J1754', 'J1755', 'J1769', 'J1770', 'J1773', 'J1774', 'J1781', 'J1801', 'J1803', 'J1812', 'J1817', 'J1831', 'J1835', 'J1837', 'J1841', 'J1842', 'J628', 'J722', 'J836', 'J897', 'J898', 'J901', 'J926', 'J952', 'J968', 'J974', 'J975', 'J979', 'J981', 'J982', 'J984', 'Jeffers', 'Junction_Hilltop_Wind', 'Kas_Farms', 'Kirkwood_Community_College', 'Lake_Benton_II_Repower', 'Lake_Benton_II', 'Lake_Benton_I', 'Lake_Winds', 'Lakefield', 'Lakeswind', 'Lakota_Ridge', 'Lakota_Wind', 'Langdon_-_OTP', 'Langdon_II', 'Langdon', 'Laurel', 'Little_Cedar', 'Lost_Lakes_Wind_Farm', 'Lundgren', 'Luther_College', 'Luverne', 'Mackinaw_City_(Bay_Windpower_I)', 'Mackinaw_City', 'Macksburg', 'Marshall', 'McKinley_Wind_Park', 'McNeilus', 'Meadow_Lake_VI', 'Meadow_Ridge', 'Michigan_Wind_II', 'Michigan_Wind_I', 'MinWind_III-IX', 'MinWind_I_&_II', 'Minden_Wind_Park', 'Minn-Dakota', 'Missouri_River_Energy_Services_(MRES)', 'Montfort_Wind_Farm', 'Moraine_II', 'Moraine_Wind_Power_project', 'Morning_Light', 'Moulton,_Chandler_Hills_Wind_Farm_Phase_II', 'Mountain_Lake_Wind', 'Mower_County_Wind_Energy_Center', 'New_Frontier', 'New_Harvest', 'New_London', 'Nobles', 'North_Dakota_Wind_II', 'North_Dakota_Wind_I', 'North_English', 'North_Shaokatan_Wind_Farm', "O'Brien", 'Oak_Glen_Wind_Project', 'Odell', 'Odin', 'Oliver_County_Wind_Energy_Center', 'Oliver_III', 'Oliver_II', 'Orient_2019', 'Orient_I', 'Osage_Utilities', 'Pegasus', 'Pembina_Border_Station', 'Pheasant_Run_I', 'Pigeon_Creek', 'Pine_River', 'Pinnebog', 'Pioneer_Grove', 'Pioneer_Prairie_II', 'Pioneer_Prairie_I', 'Pioneer_Trail', 'Pleasant_Valley', 'Pocahontas_Prairie', 'Pomeroy_(expansion)', 'Pomeroy_III', 'Pomeroy_II', 'Pomeroy_I', 'Prairie_II', 'Prairie_Rose', 'Prairie_Star', 'Prairie', 'Quilt_Block', 'Rail_Splitter', 'Red_Pine', 'Redwood_Falls_(SMMPA)', 'Ridgewind', 'Rippey', 'Rolling_Hills', 'Roseman_Energy_LLC', 'Rosiere_Wind_Farm', 'Rugby', 'Ruthton_Wind_Farm', 'SC_Johnson_Waxdale_Plant', 'Saratoga', "Settler's_Trail", 'Shaokatan_Hills', 'Shirley', 'Sibley_Wind_Farm', 'Sigel_Wind_Park', 'Sky_Volt', 'South_Fork', 'Stoneray_II', 'Stoneray', 'Stoney_Corners_-_Repower', 'Stoney_Corners_III', 'Stoney_Corners_II', 'Stoney_Corners', 'Storm_Lake_II', 'Storm_Lake_I', 'Story_City_Wind', 'Story_County', 'Story_II_(aka_Garden_Wind)', 'Taconite_Ridge_Energy_Center', 'Tatanka', 'Thunder_Spirit_II', 'Thunder_Spirit', 'Top_of_Iowa_III', 'Top_of_Iowa_II', 'Top_of_Iowa', 'Traer_Wind', 'Trimont_Wind', 'Turtle_Creek', 'Tuscola_Bay_Wind', 'Tuscola_II', 'Uilk_Wind_Farm', 'University_of_MN_--_Morris', 'Upland_Prairie', 'Valley_View', 'Velva_Wind_Farm', 'Victory(Carroll)', 'Vienna_II', 'Vienna', 'Viking', 'Walnut_Wind_Project', 'Wapsipinicon_Wind', 'Waverly_III_(Skeets_4)', 'Waverly', 'Wellsburg', 'West_Pipestone_(Maiden_Winds)', 'Whispering_Willow_I', 'White_Oak', 'Willmar', 'Wilmont_Hills', 'Wilton_Wind_Energy_Center_II', 'Wilton_Wind_Farm', 'Wind_GEM', 'Wind_Walkers', 'Winnebago_I', 'Winona', 'Wiota_Wind', 'Wolf', 'Wolverine'],
                         'Solar': ['Acturus_Community_Solar', 'Albany_Solar', 'Altair_Community_Solar_Garden', 'Andromeda_Community_Solar', 'Annandale_Solar', 'Anoka_County_MN_CONX', 'Antares_Community_Solar', 'Antlia_Community_Solar', 'Aquarius_Community_Solar', 'Aquila_Community_Solar', 'Arcadia_Solar', 'Argo_Navis_Community_Solar', 'Aries_Community_Solar', 'Armstrong_Solar', 'Athens_MN_CONX', 'Atwater_Solar', 'Auriga_Community_Solar', 'B_R_Corcoran_CSG', 'B_R_Sartell_CSG', 'B_R_Sauk_Rapids_CSG', 'Barone_CSG', 'Becker_Solar_2_CSG', 'Becker_Solar_3_CSG', 'Becker_Solar_4_CSG', 'Becker_Solar_5_CSG', 'Becker_Solar_CSG', 'Belmont', 'BentonSun_LLC', 'Betcher_Community_Solar_Garden', 'Big_Lake_Holdco_Solar_CSG', 'Big_Lake_Project_CSG', 'Bloomfield_Municipal_Utilities_Solar', 'Blue_Lake_Solar', 'Bolduan_CSG', 'CF_Novel_Solar_CSG_Gardens_Eleven_LLC', 'CF_Novel_Solar_CSG_Gardens_Five_LLC', 'CF_Novel_Solar_CSG_Gardens_Seven_LLC', 'CF_Novel_Solar_CSG_Gardens_Two_LLC', 'CGSun_LLC_Community_Solar', 'Caelum_Community_Solar', 'Camp_Atterbury_Microgrid', 'Canopus_Community_Solar', 'Capella_Community_Solar', 'Capricornus_Community_Solar_Garden', 'Carina_Community_Solar', 'Carver_Gladden_CSG', 'Cashton_Solar', 'Cassiopeia_Community_Solar', 'Cedar_Falls_Solar_Farm', 'Centaurus_Community_Solar', 'Chisago_Community_Solar', 'Chisago_Holdco_LLC_CSG', 'Chisago_Solar', 'Clara_City_Solar', 'Clear_Garden_CSG', 'Conrath_DPC_Solar', 'Corcoran_CSG', 'Cornillie', 'Corvus_Community_Solar', 'Cottage_Grove_CSG_LLC', 'Cottage_Grove_Project_CSG', 'Crane_Solar_Facility', 'Crater_Community_Solar', 'Crawfordsville_2_Solar_Park', 'Crawfordsville_3_Solar_Park', 'Crux_Community_Solar', 'Cumberland_Solar', 'DG_AMP_Solar_Coldwater', 'Dakota_Community_Solar_One_LLC_CSG', 'Decatur_Co_Solar_RES_IN', 'Delphinus_Community_Solar', 'Delta_Solar_Power_II', 'Delta_Solar_Power_I', 'Demille_Solar_Farm', 'Deneb_Community_Solar', 'Dickinson_Solar_Array', 'DodgeSun_CSG', 'Dodge_Center_Solar', 'Dodge_Holdco_Solar_CSG', 'Domino_Farms_Solar', 'Douglas_Todd_Community_Solar_One_LLC_CSG', 'Downsville_DPC_Solar', 'Duke_Building_129', 'Duke_Building_87', 'Duke_Building_98', 'Dundas_Solar_Holdings_LLC_CSG', 'E_Goenner_Project_CSG', 'East_Chicago', 'Eastern_Iowa_Solar', 'Eastwood_Solar', 'Eichtens_Community_Solar', 'Eichtens_II_CSG', 'Ellettsville_Solar_RES', 'Elroy_Solar', 'Empire_Solar', 'Enter_Solar', 'Epic_Verona', 'Equuleus_Community_Solar_Gardens', 'FECC_Solar_Benton', 'Farmington_Holdco_Solar', 'Farmington_Solar_Farm', 'FastSun_13_CSG', 'FastSun_14_CSG', 'FastSun_1_CSG', 'FastSun_3_CSG', 'FastSun_7_CSG', 'FastSun_8_CSG', 'Felton_CSG_PV1_5', 'Fennimore_Solar', 'Flambeau_Solar_Partners', 'Ford_World_Headquarters', 'Foreman_s_Hill_Community_Solar', 'Forest_City_Solar', 'Forest_Lake_Solar_CSG', 'Fox_CSG_LLC', 'Frontenac_Holdco_LLC_CSG', 'GRE_Marshan_Solar', 'GSPP_Held_LLC_CSG', 'GSPP_Imholte_CSG', 'GSSP_Schneider_LLC', 'Gemini_Community_Solar', 'Geneseo', 'Gibbon_Solar', 'Goose_Lake_MN_DPC_GM', 'Gopher_CSG', 'Grand_Valley_Solar_Gardens', 'Green_Lake_Solar', 'Greenwood_Solar_Farm', 'Griffith', 'Grimm_Community_Solar', 'Guse_CSG', 'HQC_Rock_River_Solar_Power_Gen_Station', 'Hammer_CSG', 'Hampton_MN_GRE', 'Hartmann_Project_CSG', 'Hastings_Solar', 'Haven_Solar_Project_CSG', 'Held_Solar_Project', 'Henryville_Solar_RES', 'Heyer_CSG', 'Hobart_Solar_LLC', 'Huneke_II_CSG', 'Huneke_I_CSG', 'Hwy_14_Holdco_Solar_CSG', 'IKEA_Canton_Rooftop_PV_System', 'IKEA_Oak_Creek_Rooftop_PV_System', 'IKEA_St_Louis_410', 'IMPA_Crawfordsville_Solar_Park', 'IMPA_Huntingburg_Solar_Park', 'IMPA_Pendleton_Solar_Park', 'IMPA_Peru_Solar_Park', 'IMPA_Rensselaer_Solar_Park', 'IMPA_Tell_City_Solar_Park', 'IMPA_Washington_Solar_Park', 'INDY_III', 'IND_Community_Solar_Farm_1st_Phase', 'IND_Solar_Farm_Phase_IIA', 'Indianapolis_Motor_Speedway_Solar_PV', 'Indy_Grocers', 'Indy_Solar_III_LLC', 'Indy_Solar_II_LLC', 'Indy_Solar_I_LLC', 'J1000', 'J1002', 'J1003', 'J1027', 'J1028', 'J1034', 'J1042', 'J1058', 'J1062', 'J1063', 'J1067', 'J1071', 'J1074', 'J1087', 'J1092', 'J1094', 'J1096', 'J1098', 'J1102', 'J1107', 'J1110', 'J1111', 'J1112', 'J1124', 'J1128', 'J1131', 'J1132', 'J1135', 'J1145', 'J1152', 'J1153', 'J1154', 'J1164', 'J1169', 'J1171', 'J1172', 'J1174', 'J1182', 'J1188', 'J1190', 'J1191', 'J1192', 'J1196', 'J1203', 'J1204', 'J1205', 'J1208', 'J1209', 'J1210', 'J1211', 'J1212', 'J1214', 'J1215', 'J1216', 'J1217', 'J1218', 'J1219', 'J1221', 'J1222', 'J1223', 'J1224', 'J1225', 'J1226', 'J1227', 'J1231', 'J1232', 'J1234', 'J1235', 'J1239', 'J1241', 'J1242', 'J1243', 'J1248', 'J1251', 'J1253', 'J1254', 'J1255', 'J1265', 'J1266', 'J1268', 'J1275', 'J1279', 'J1281', 'J1282', 'J1284', 'J1286', 'J1294', 'J1295', 'J1296', 'J1297', 'J1298', 'J1299', 'J1300', 'J1301', 'J1302', 'J1303', 'J1304', 'J1305', 'J1306', 'J1307', 'J1308', 'J1310', 'J1311', 'J1312', 'J1313', 'J1314', 'J1318', 'J1322', 'J1325', 'J1328', 'J1330', 'J1331', 'J1332', 'J1337', 'J1342', 'J1347', 'J1348', 'J1350', 'J1352', 'J1356', 'J1361', 'J1363', 'J1367', 'J1368', 'J1369', 'J1372', 'J1373', 'J1375', 'J1377', 'J1378', 'J1379', 'J1381', 'J1382', 'J1383', 'J1385', 'J1386', 'J1387', 'J1388', 'J1389', 'J1390', 'J1391', 'J1392', 'J1393', 'J1394', 'J1395', 'J1396', 'J1398', 'J1399', 'J1401', 'J1403', 'J1405', 'J1407', 'J1410', 'J1413', 'J1415', 'J1416', 'J1419', 'J1421', 'J1424', 'J1426', 'J1428', 'J1430', 'J1431', 'J1434', 'J1436', 'J1438', 'J1440', 'J1441', 'J1442', 'J1445', 'J1446', 'J1447', 'J1448', 'J1449', 'J1450', 'J1452', 'J1455', 'J1457', 'J1458', 'J1460', 'J1461', 'J1463', 'J1464', 'J1465', 'J1466', 'J1471', 'J1472', 'J1473', 'J1474', 'J1475', 'J1481', 'J1482', 'J1497', 'J1500', 'J1502', 'J1503', 'J1504', 'J1509', 'J1510', 'J1513', 'J1514', 'J1516', 'J1518', 'J1519', 'J1520', 'J1526', 'J1527', 'J1529', 'J1530', 'J1532', 'J1533', 'J1534', 'J1537', 'J1539', 'J1542', 'J1544', 'J1550', 'J1552', 'J1556', 'J1558', 'J1559', 'J1560', 'J1561', 'J1562', 'J1563', 'J1564', 'J1565', 'J1566', 'J1567', 'J1573', 'J1576', 'J1577', 'J1578', 'J1579', 'J1581', 'J1582', 'J1583', 'J1585', 'J1587', 'J1588', 'J1591', 'J1592', 'J1593', 'J1596', 'J1597', 'J1598', 'J1600', 'J1603', 'J1604', 'J1605', 'J1610', 'J1611', 'J1612', 'J1614', 'J1615', 'J1616', 'J1618', 'J1619', 'J1620', 'J1622', 'J1624', 'J1625', 'J1626', 'J1629', 'J1630', 'J1632', 'J1634', 'J1636', 'J1637', 'J1638', 'J1641', 'J1644', 'J1646', 'J1649', 'J1651', 'J1652', 'J1653', 'J1654', 'J1657', 'J1658', 'J1661', 'J1663', 'J1664', 'J1668', 'J1669', 'J1670', 'J1671', 'J1672', 'J1673', 'J1677', 'J1679', 'J1680', 'J1681', 'J1684', 'J1687', 'J1690', 'J1691', 'J1696', 'J1697', 'J1699', 'J1703', 'J1705', 'J1706', 'J1707', 'J1710', 'J1712', 'J1714', 'J1716', 'J1719', 'J1721', 'J1722', 'J1724', 'J1726', 'J1730', 'J1732', 'J1734', 'J1735', 'J1736', 'J1737', 'J1740', 'J1743', 'J1744', 'J1745', 'J1747', 'J1748', 'J1750', 'J1751', 'J1752', 'J1760', 'J1762', 'J1765', 'J1771', 'J1772', 'J1777', 'J1778', 'J1779', 'J1780', 'J1782', 'J1783', 'J1784', 'J1785', 'J1786', 'J1789', 'J1792', 'J1794', 'J1795', 'J1796', 'J1797', 'J1799', 'J1802', 'J1808', 'J1809', 'J1811', 'J1814', 'J1815', 'J1816', 'J1818', 'J1820', 'J1823', 'J1824', 'J1827', 'J1829', 'J1832', 'J1836', 'J1840', 'J874', 'J877', 'J956', 'J976', 'J987', 'J991', 'J992', 'J993', 'J994', 'J996', 'Jackson_Co_Solar_RES', 'Jefferson_Solar_Park', 'John_A_Logan_College_Solar', 'Johnson_1_Community_Solar', 'Johnson_Co_Solar_RES', 'Johnson_II_Community_Solar', 'Johnson_Solar_CSG', 'Kaus_Community_Solar', 'Kokomo_Solar_1_LLC', 'Koppelman_Sun_CSG', 'Kramer_Solar_CSG', 'Krause_CSG', 'Lady_Slipper_Solar_Array_CSG', 'Lafayette_DPC_Solar', 'Lahr_1_LLC', 'Lake_Emily_Solar', 'Lake_Pulaski_Solar', 'Lake_Region_Community_Hybrid_LLC', 'Lake_Waconia_Community_Solar_Garden', 'Lake_Waconia_IV_Community_Solar_Garden', 'Lanesville_Solar_RES', 'Lange_Solar', 'Lawrence_Creek_Solar', 'LeSun_CSG_LLC', 'Lemond_Solar', 'Lenape_II', 'Leo_Community_Solar', 'Liberty_Pole_DPC_Solar', 'Libra_Community_Solar', 'Lincoln_Solar', 'Lind_Solar_CSG', 'Lindstrom_Solar_CSG', 'Lyra_Community_Solar', 'M72_West_Solar', 'MSC_Chisago01_LLC_CSG', 'MSC_Chisago02_LLC', 'MSC_Empire01_LLC', 'MSC_GreyCloud01_Community_Solar', 'MSC_Rice01_LLC_CSG', 'MSC_Scandia01_CSG', 'MSC_Scott01_LLC', 'M_G_Emmett_J_Bean_Federal_Center', 'Malmedal_Solar_Garden', 'Mapleton_Community_Solar', 'Marion_Solar_LNG', 'Marmas_Solar_CSG', 'Marshall_Solar_Energy_Project', 'Maywood_Photovoltaic_Project', 'McDonald_Solar_Farm_LLC', 'McLeod_Community_Solar_One_LLC_CSG', 'Medford_DPC_Solar', 'Meeker_Community_Solar_One_LLC_CSG', 'Michael_Solar', 'Middlebury_Solar', 'MontSun_Community_Solar', 'Montevideo_Solar_LLC_CSG', 'Montgomery_Winsted_CSG', 'Monticello_Project_CSG', 'Montrose_Solar', 'Morgan_Community_Solar', 'Mt_Hope_DPC_Solar', 'Nautilus_Lindstrom_Solar_CSG', 'Nautilus_Saint_Cloud_Solar_CSG', 'Nautilus_Winsted_Solar_CSG', 'Nesvold_Watertown_Solar', 'New_Auburn_DPC_Solar', 'New_Castle_Solar_RES', 'New_Germany_Community_Solar_Garden', 'New_Haven_Solar_RES', 'New_Lisbon_Solar', 'New_Munich_Solar', 'New_Orleans_Solar_Power_Plant', 'North_Star_Solar_Project', 'Northfield_Community_Solar', 'Northfield_Holdco_CSG', 'Novel_Brooten_Solar_CSG', 'Novel_Historical_Society_Solar_CSG', 'Novel_Martin_Solar_One_LLC_McLeod_CSG', 'Novel_OYA_of_Mapleton_CSG', 'Novel_OYA_of_Osakis_CSG', 'Novel_Reber_Solar_CSG', 'O_Fallon_Renewable_Energy_Center', 'O_Shea_Solar_Farm', 'Oak_Hill_Solar_Array', 'Olinda_Trail_Solar', 'Orion_Community_Solar', 'Osage_IA', 'Pastime_Farm_LLC', 'Paynesville_Community_Solar', 'Paynesville_Solar', 'Pegasus_Community_Solar', 'Phoenix_Solar_South_Farms_LLC_Solar_Farm', 'Pierre_Solar', 'Pine_Island_Solar_CSG', 'Pine_Island_Solar', 'PopeSun_CSG_LLC', 'Porcher_CSG', 'Portage_Solar', 'Porter_Way_Community_Solar_Garden', 'RJC_II_Community_Solar_Garden', 'RJC_I_CSG', 'Randolph_CSG_PV1_5', 'Rantoul_Solar', 'Red_Maple_Solar', 'Red_Wing_Community_Solar', 'Rengstorf_Solar_CSG', 'Rensselaer_Solar_', 'Richmond_CSG', 'Roberds_Garden_CSG', 'Rockville_Solar_II_LLC', 'Rockville_Solar_I_LLC', 'Rollingstone_Holdco_CSG', 'Rosemount_Community_Solar', 'Sagitta_Community_Solar', 'Sand_Lake_DPC_Solar', 'Sartell_Holdco_CSG', 'Sauk_DPC_Solar', 'Scandia_CSG', 'Scandia_Community_Solar_Garden', 'School_Sisters_CSG', 'Schultz_CSG', 'Schwinghamer_Project_CSG', 'Scotland_Solar_RES', 'Shakopee_Met_Council_WTP', 'Sherburne_Community_Solar_One_LLC_CSG', 'Sherburne_Community_Solar', 'Sherburne_North_Project_CSG', 'Sheridan_School_Corporation_Solar', 'Slayton_Solar', 'Spartan_PV_1_LLC', 'Spica_Community_Solar', 'Spring_Mill_Solar_RES', 'St_Charles_Solar', 'St_Cloud_Solar_CSG', 'St_Paul_Intl_Airport_Red_Blue_Parking', 'Staunton', 'Stearns_Community_Solar_One_LLC_CSG', 'Stearns_Solar_I', 'Strawberry_Point_DPC_Solar', 'Stuttgart_Solar', 'Sumrall_II_Solar_Farm', 'SunE_Feely_1_CSG_LLC', 'SunE_Stolee_CSG_LLC', 'Sunrise_Community_Solar', 'Syncarpha_Clara_City_CSG_I_Stamer', 'Syncarpha_Dodge_1_CSG', 'Syncarpha_Prinsburg_CSG_Ledeboer', 'TAC_Distributed_Energy_Resource_Hybrid', 'TCLP_Solar_Phase_1', 'Tatanka_Wi', 'Taurus_Community_Solar', 'Taylors_Falls_CSG', 'Tiller_CSG', 'Tippecanoe_Solar_Power_Plant', 'Tipton_Solar_Park', 'Turrill_Solar_Farm', 'USS_Big_Lake_1_Solar_CSG', 'USS_Brockway_Solar_CSG', 'USS_Brude_Solar_CSG', 'USS_Centerfield_Solar_CSG', 'USS_Cheyenne_Solar_LLC_CSG', 'USS_DVL_Solar_CSG', 'USS_Dubhe_Solar_CSG', 'USS_East_Hauer_Watt_CSG', 'USS_Eggo_Solar_CSG', 'USS_Good_Solar_CSG', 'USS_Greenhouse_Solar_LLC_CSG', 'USS_Haven_Solar_LLC_CSG', 'USS_Hockey_Pad_Solar_CSG', 'USS_JJ_Solar_CSG', 'USS_Kasch_Solar_CSG', 'USS_King_2_CSG', 'USS_Kost_Trail_Solar_CSG', 'USS_Lake_Patterson_Solar_CSG', 'USS_Midtown_Solar_LLC_CSG', 'USS_Monarch_Solar_LLC_CSG', 'USS_Nillie_Corn_Solar_CSG', 'USS_Norelius_Solar_CSG', 'USS_Rapidan_Solar_CSG', 'USS_Rockpoint_Solar_CSG', 'USS_Solar_Dawn_CSG', 'USS_Solar_Rapids_CSG', 'USS_Webster_Solar_CSG', 'USS_White_Cloud_LLC_CSG', 'Ursa_Community_Solar', 'Valparaiso_Solar_LLC', 'Vega_Community_Solar', 'Vermillion_River_MN_GRE_DEA_GM', 'Veseli_Community_Solar_Garden', 'Volkman_Road_Solar_Array_Hybrid', 'Wabasha_Holdco_Solar_CSG', 'Wabasha_Solar', 'WakeSun_LLC', 'Warren_DPC_Solar', 'WasecaSun', 'Waseca_Solar', 'Waterford_Holdco_CSG', 'Waterloo_Solar_LLC', 'Waterville_CSG_Solar_Holdings_LLC', 'WaveSun_Community_Solar', 'Webster_Holdco_Solar_CSG', 'West_Dubuque_Solar', 'West_Faribault_Solar', 'West_Waconia_Solar', 'Western_Michigan_Solar_Gardens', 'Whistling_Winds_DPC_Solar', 'Winegar_CSG', 'Winona_Solar', 'Wollan_Garden_Solar', 'WrightSun_CSG_LLC', 'Wright_Cuddyer_CSG', 'Wright_Kirby_1_5_CSG', 'Wyoming_2_CSG_LLC', 'Zumbro_Community_Solar_Garden']}}
ISO_to_zones = {'ERCOT': ['Coast', 'East', 'Far_West', 'North_Central', 'North', 'South_Central', 'Southern', 'West'],
                 'NYISO': ['CAPITL', 'CAPITL', 'CENTRL', 'CENTRL', 'GENESE', 'GENESE', 'HUD VL', 'HUD VL', 'LONGIL', 'LONGIL', 'MHK VL', 'MHK VL', 'MILLWD', 'MILLWD', 'N.Y.C.', 'N.Y.C.', 'NORTH', 'NORTH', 'WEST', 'WEST'],
                 'MISO': ['LRZ1', 'LRZ1', 'LRZ2_7', 'LRZ2_7', 'LRZ3_5', 'LRZ3_5', 'LRZ4', 'LRZ4', 'LRZ6', 'LRZ6', 'LRZ8_9_10', 'LRZ8_9_10']}
ISOs = list(ISO_to_sites.keys())

levels = np.linspace(0,1, 100, endpoint=False)[1:] # 0.01, 0.02, ..., 0.99

def process_energy_data(true_path, forecast_path, hour='all',
                        return_df=False, 
                        transpose_forecast=False):
    '''
    Process energy data from S3 paths for true values and forecasts.
    
    Inputs:
        true_path: (str) S3 path to the true values file
        forecast_path: (str) S3 path to the forecast file
        return_df: (bool) whether to return a DataFrame with time stamps, actual values, and forecast values
    
    Returns:
        Y: np.ndarray of true values
        Y_forecast: np.ndarray of forecast values (transposed)
        df: pd.DataFrame if return_df is True
    '''
    fs = s3fs.S3FileSystem(anon=True)

    def clean_time(col):
        raw_times = col.astype(str)
        cleaned_times = [t.split('+')[0] for t in raw_times]  # drop timezone entirely 
        dates = pd.to_datetime(cleaned_times, utc=True)

        return dates

    # Load in true values
    with fs.open(true_path, 'rb') as s3:
        with h5py.File(s3, 'r') as f:
            # print('Keys:', list(f.keys())) # print attributes of f
            actual_time = clean_time(f['time_index'][...])
            Y_all = f['actuals'][...]
    # Load forecast
    with fs.open(forecast_path, 'rb') as s3:
        with h5py.File(s3, 'r') as f:
            forecast_time = clean_time(f['forecast_time'][...])
            # Note: The issue times are 6 on 12/30/2017, 24 on 12/31/2017 - 12/29/2018 and 18 on 12/30/2018. All at 18:00 UTC
            issue_time = clean_time(f['issue_time'][...]) 
            Y_forecast = f['forecasts'][...] # timesteps x num_forecast_levels 

            if transpose_forecast:
                Y_forecast = Y_forecast.T  

    # Pull values on the hour (1:00, 2:00, etc)
    if hour == 'all':
        Y = Y_all[actual_time.minute == 0]
        actual_time = actual_time[actual_time.minute == 0]
        Y_forecast  = Y_forecast[forecast_time.minute == 0]
        forecast_time = forecast_time[forecast_time.minute == 0]
        issue_time = issue_time[forecast_time.minute == 0]

        assert np.all(actual_time == forecast_time), "Forecast and actuals time indices do not match."
    # Pull Y and Y_forecast for forecast times for specific hour of the day
    else:
        assert hour in [h for h in range(24)], "Hour must be 'all' or an int between 0 and 23."
        hour = int(hour)
        # Filter to only the forecasts issued for the specified hour of the day
        mask = (forecast_time.hour == hour)
        Y_forecast = Y_forecast[mask, :]
        forecast_time = forecast_time[mask]

        # Iterate through forecast time and get actual Y at that time
        Y = []
        for ft in forecast_time:
            idx = np.where(actual_time == ft)[0]
            if len(idx) == 1:
                Y.append(Y_all[idx[0]])
            else:
                Y.append(np.nan)
                print(f"Warning: No matching actual time for forecast time {ft}")
        Y = np.array(Y)

    if return_df:
        # Create a DataFrame with the actuals and forecasts
        cols = { 'time': actual_time, 'Y': Y}
        for i, level in enumerate(levels):
            cols[f'p{int(level*100)}'] = Y_forecast[:, i]
        df = pd.DataFrame(cols)
        return df
    
    Y = Y.astype(float)

    return Y, Y_forecast.T

def get_energy_data(ISO, site, hour='all', target_variable='Wind', horizon='Day-ahead',
                    Yhat_type='quantile-specific', return_df=False):
    '''
    Get forecasts and true values 

    Inputs:
        forecaster: (string) Independent System Operator. Options are anything in ISOs
        site: (string) Name of the site. Options are anything in ISO_to_sites[forecaster][target_variable]
        hour: (string) Which hour of the day to pull (e.g., 'all', '00', '01', ..., '23'). 'all' returns all hours
        horizon: (string) Options are 'Day-ahead', 'Intra-day', 'Intra-hour'
        Yhat_type: str, type of forecast to return ('point' (median), 'quantile-specfic', 'none')
        levels: only needed if Yhat_type is 'quantile-specific'
        truncate_negY: boolean, whether to truncate negative values in Y to 0
        return_df: boolean, whether to return a DataFrame with time stamps, actual values, and forecast values
    '''

    assert horizon == 'Day-ahead', "Other horizons are available on S3 but not implemented in this function yet."
    assert Yhat_type == 'quantile-specific', "Only quantile-specific forecasts are implemented."

    if ISO == 'ERCOT':
        year = 2018
    else:
        year = 2019

    true_path = f's3://arpa-e-perform/{ISO}/{year}/{target_variable}/Actuals/Site_level/Site_{site}_{target_variable.lower()}_actuals_{year}.h5'
    
    site_name = site.lower() if target_variable == 'Wind' else site
    forecast_path = f's3://arpa-e-perform/{ISO}/{year}/{target_variable}/Forecasts/{horizon}/Site_level/Site_{site_name}_{target_variable.lower()}_{horizon.lower()}_fcst_{year}.h5'

    return process_energy_data(true_path, forecast_path, return_df=return_df, hour=hour)


if __name__ == "__main__":
    ## Example usage

    ## Get forecasts and true values for forecasts for 8:00 each day

    Y, Yhat = get_energy_data('ERCOT', 'Aguayo_Wind', target_variable='Wind', hour=8)
    print("True values:", Y)
    print("Forecasts:", Yhat)

    ## Get forecasts and true values for forecasts for all hours (separately)
    # for h in range(24):
    #     Y, Yhat = get_energy_data('ERCOT', 'Aguayo_Wind', hour=h)
    #     print(f"Hour {h}: True values length: {len(Y)}, Forecasts shape: {Yhat.shape}")

    ## Get forecasts and true values for all hours together and also get time stamps
    # df = get_energy_data('ERCOT', 'Aguayo_Wind', return_df=True)
    # print(df.head())
    